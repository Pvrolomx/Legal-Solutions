generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String    @id @default(cuid())
  email         String    @unique
  password      String
  name          String?
  role          String    @default("lawyer")
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}

model Client {
  id            String    @id @default(cuid())
  name          String
  rfc           String?
  curp          String?
  phone         String
  email         String?
  address       String?
  notes         String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  cases         Case[]
  invoices      Invoice[]
}

model Case {
  id              String    @id @default(cuid())
  clientId        String
  caseNumber      String?
  court           String?
  judge           String?
  caseType        String
  matter          String
  description     String?
  status          String    @default("activo")
  opponent        String?
  opponentLawyer  String?
  startDate       DateTime  @default(now())
  endDate         DateTime?
  notes           String?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  
  client          Client    @relation(fields: [clientId], references: [id])
  hearings        Hearing[]
  documents       Document[]
  tasks           Task[]
  aiChats         AIChat[]
  
  @@index([clientId])
  @@index([status])
}

model Hearing {
  id            String    @id @default(cuid())
  caseId        String
  date          DateTime
  time          String
  type          String
  location      String?
  notes         String?
  result        String?
  status        String    @default("programada")
  reminderSent  Boolean   @default(false)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  case          Case      @relation(fields: [caseId], references: [id])
  
  @@index([caseId])
  @@index([date])
}

model Document {
  id            String    @id @default(cuid())
  caseId        String
  name          String
  docType       String
  filename      String
  url           String
  aiSummary     String?
  createdAt     DateTime  @default(now())
  
  case          Case      @relation(fields: [caseId], references: [id])
  
  @@index([caseId])
}

model Task {
  id            String    @id @default(cuid())
  caseId        String?
  title         String
  description   String?
  dueDate       DateTime?
  priority      String    @default("media")
  status        String    @default("pendiente")
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  case          Case?     @relation(fields: [caseId], references: [id])
  
  @@index([caseId])
  @@index([status])
}

model Invoice {
  id            String    @id @default(cuid())
  clientId      String
  concept       String
  amount        Float
  currency      String    @default("MXN")
  status        String    @default("pendiente")
  dueDate       DateTime?
  paidDate      DateTime?
  notes         String?
  createdAt     DateTime  @default(now())
  
  client        Client    @relation(fields: [clientId], references: [id])
  
  @@index([clientId])
  @@index([status])
}

model AIChat {
  id            String    @id @default(cuid())
  caseId        String?
  query         String
  response      String
  createdAt     DateTime  @default(now())
  
  case          Case?     @relation(fields: [caseId], references: [id])
  
  @@index([caseId])
}

model Template {
  id            String    @id @default(cuid())
  name          String
  docType       String
  content       String
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}
